---
import SvgBoxTop from './SvgBoxTop.astro';
---

<section id="contact" class="relative w-full bg-stone-800 pt-16">

  <SvgBoxTop id="box" twClasses="absolute bottom-0" />
  
  <aside id="success" class="absolute w-full h-full flex flex-col items-center justify-center text-center">
    <div class="text-8xl flex">
      <p class="-rotate-12 mt-2">🐶</p>
      <p>🥳</p>
      <p class="rotate-12">😸</p>
    </div>
    <p class="text-6xl text-emerald-300 font-bold -rotate-3 mt-4">Hey thanks!</p>
  </aside>

  <article id="paper" class="relative w-full max-w-2xl mx-auto bg-gradient-to-b from-purple-50 via-purple-50 to-indigo-200 transition origin-bottom">
    <form name="contact" method="POST" action="/#contact" data-netlify="true" class="relative h-full p-16 flex flex-col">
      <label for="message" class="text-sm sm:text-xl font-bold tracking-wider">Dear Tara,</label>
      <textarea id="message" name="message" placeholder="u make nice books" rows="3" data-min-rows="3" class="mt-4 mb-16 bg-indigo-200/50 focus:bg-white rounded-lg border-none font-bold text-sm sm:text-xl placeholder-indigo-400 tracking-wider"></textarea>
      <label for="sender" class="font-bold tracking-wider cursor-default text-sm sm:text-xl">From,</label>
      <input id="sender" name="sender" placeholder="Your name" type="text" class="mt-2 max-w-xs bg-indigo-200/50 focus:bg-white rounded-lg border-none text-sm sm:text-xl placeholder-indigo-400 font-bold tracking-wide">
      <button id="submit" disabled type="submit" class="mt-6 self-end btn btn-green">SEND</button>
    </form>
  </article>

</section>

<script>
  window.addEventListener('load', () => {
    const formContainer = document.getElementById('form-container');
    const mainContainer = document.getElementById('main-container');
    
    // Calculate the height of the contact form container
    const contactFormHeight = formContainer.offsetHeight;
    
    // Set the initial position of the form container above the viewport by its height
    formContainer.style.top = `-${contactFormHeight}px`;
    
    let isFormVisible = false;
    
    document.getElementById('sliderButton').addEventListener('click', function() {
      if (isFormVisible) {
        // Hide the contact form
        formContainer.style.transform = `translateY(0)`;
        mainContainer.style.transform = `translateY(0)`;
      } else {
        // Show the contact form
        formContainer.style.transform = `translateY(${contactFormHeight}px)`;
        mainContainer.style.transform = `translateY(${contactFormHeight}px)`;
      }
      isFormVisible = !isFormVisible;
    });
  });

  document.addEventListener('DOMContentLoaded', () => {
    const formElement = document.querySelector('form[name="contact"]');
    const messageInput = document.getElementById('message');
    const senderInput = document.getElementById('sender');
    const submitButton = document.getElementById('submit');

    function enableSubmitButton() {
      if (submitButton instanceof HTMLButtonElement && 
          messageInput instanceof HTMLTextAreaElement && 
          senderInput instanceof HTMLInputElement) {
        submitButton.disabled = (messageInput.value.trim() === '' || senderInput.value.trim() === '');
      }
    }

    function handleFormSubmission(e) {
      e.preventDefault();
      const form = e.target;
      const { action } = form;

      const headers = {
        'Accept': 'application/x-www-form-urlencoded;charset=UTF-8',
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      };

      const formData = new FormData(form);
      const formDataEntries = Array.from(formData.entries()).map(([key, value]) => [key, value.toString()]);
      const body = new URLSearchParams(formDataEntries).toString();

      fetch(action, { method: 'POST', headers, body })
        .then(response => {
          if (response.ok) {
            handleFormSubmissionSuccess();
          } else {
            throw new Error(`Network response was not ok. Response status: ${response.status}`);
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }

    function handleFormSubmissionSuccess() {
      const paperElement = document.getElementById('paper');
      paperElement.style.transform = 'scaleY(0)';
    }

    formElement.addEventListener('input', (e) => {
      if (e.target === messageInput || e.target === senderInput) {
        enableSubmitButton();
      }
    });

    formElement.addEventListener('submit', handleFormSubmission);
  });
</script>