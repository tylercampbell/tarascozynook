---
import SvgBoxTop from './SvgBoxTop.astro';
---

<section id="contact" class="relative w-full pt-8 sm:pt-16">

  <SvgBoxTop id="box" twClasses="absolute bottom-0" />
  
  <aside id="success" class="absolute w-full h-full flex flex-col items-center justify-center text-center">
    <div class="text-4xl sm:text-8xl flex">
      <p class="-rotate-12 mt-2">🐶</p>
      <p>🥳</p>
      <p class="rotate-12">😸</p>
    </div>
    <p class="sm:mt-4 text-4xl sm:text-6xl text-emerald-300 font-bold -rotate-3">Hey thanks!</p>
  </aside>

  <article id="paper" class="relative w-full transition origin-bottom px-8 sm:px-16 md:px-0">
    <form name="contact" method="POST" action="/#contact" data-netlify="true" class="max-w-2xl mx-auto relative h-full p-4 sm:p-16 flex flex-col bg-gradient-to-b from-purple-50 via-purple-50 to-indigo-200">
      <label for="message" class="text-sm sm:text-xl font-bold tracking-wider">Dear Tara,</label>
      <textarea id="message" name="message" placeholder="u make nice books" rows="3" data-min-rows="3" class="mt-4 mb-16 bg-indigo-200/60 focus:bg-white rounded-lg border-none font-bold text-sm sm:text-xl placeholder-indigo-400 tracking-wider"></textarea>
      <label for="sender" class="font-bold tracking-wider cursor-default text-sm sm:text-xl">From,</label>
      <input id="sender" name="sender" placeholder="Your name" type="text" class="mt-2 max-w-xs bg-indigo-200/60 focus:bg-white rounded-lg border-none text-sm sm:text-xl placeholder-indigo-400 font-bold tracking-wide">
      <button id="submit" disabled type="submit" class="mt-6 mb-4 sm:mb-0 self-end btn btn-green text-sm sm:text-base">SEND</button>
    </form>
  </article>

</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const formElement = document.querySelector('form[name="contact"]');
    const messageInput = document.getElementById('message');
    const senderInput = document.getElementById('sender');
    const submitButton = document.getElementById('submit');

    function enableSubmitButton() {
      if (submitButton instanceof HTMLButtonElement && 
          messageInput instanceof HTMLTextAreaElement && 
          senderInput instanceof HTMLInputElement) {
        submitButton.disabled = (messageInput.value.trim() === '' || senderInput.value.trim() === '');
      }
    }

    function handleFormSubmission(e) {
      e.preventDefault();
      const form = e.target;
      const { action } = form;

      const headers = {
        'Accept': 'application/x-www-form-urlencoded;charset=UTF-8',
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      };

      const formData = new FormData(form);
      const formDataEntries = Array.from(formData.entries()).map(([key, value]) => [key, value.toString()]);
      const body = new URLSearchParams(formDataEntries).toString();

      fetch(action, { method: 'POST', headers, body })
        .then(response => {
          if (response.ok) {
            handleFormSubmissionSuccess();
          } else {
            throw new Error(`Network response was not ok. Response status: ${response.status}`);
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }

    function handleFormSubmissionSuccess() {
      const paperElement = document.getElementById('paper');
      paperElement.style.transform = 'scaleY(0)';
    }

    formElement.addEventListener('input', (e) => {
      if (e.target === messageInput || e.target === senderInput) {
        enableSubmitButton();
      }
    });

    formElement.addEventListener('submit', handleFormSubmission);
  });
</script>